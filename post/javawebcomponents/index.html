<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>JavaWebComponents - WYJ&#39;s Notes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <link rel="canonical" href="https://w-yj.github.io/post/javawebcomponents/">

    
    
    <link rel="stylesheet" type="text/css" href="https://w-yj.github.io/sass/pixyll.min.30e55e9fcc01694c576be315e114e0449103a0df1fb91cec0c2ada477ba30f6b.css">

    
    <link rel='stylesheet' type='text/css' href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' >
    <link rel='stylesheet' type='text/css' href='//fonts.googleapis.com/css?family=Lato:900,300'>
</head>

<body class="site">
    <div class="site-wrap">
        <header class="site-header px2 px-responsive">
    <div class="mt2 wrap">
        <div class="measure">
            <a href="https://w-yj.github.io" class="site-title">WYJ&#39;s Notes</a>
            <nav class="site-nav">
                
<div class="right">
<a href="https://w-yj.github.io/about/">About</a>
<a href="https://w-yj.github.io/tags/">Tags</a>
<a href="https://w-yj.github.io/contact/">Contact</a>
</div>
            </nav>
            <div class="clearfix"></div>
        </div>
    </div>
</header>

        <div class="post p2 p-responsive wrap" role="main">
            <div class="measure">
                
<div class="post-header mb2">
    <h1 class="py2">JavaWebComponents</h1>
    <span class="post-meta">
        Jul 10, 2017
        
    </span>
    <br>
    
</div>
<article class="post-content">
    <h1 id="javawebcomponents">JavaWebComponents</h1>
<blockquote>
<p>JavaWeb三大组件: Servlet、Filter、Listener</p>
</blockquote>
<!-- raw HTML omitted -->
<ul>
<li>Servlet
<ul>
<li>实现方式</li>
<li>SevletConfig &amp; ServletContext
<ul>
<li>ServletConfig</li>
<li>ServletContext</li>
<li>Servlet中对象的范围</li>
</ul>
</li>
<li>Servlet类三大域及三大组件
<ul>
<li>三大域：</li>
<li>扩展</li>
</ul>
</li>
<li>Servlet中的其他细节
<ul>
<li>如何把一个Servlet类映射成一个对外可访问的路径？</li>
<li>关于Servlet线程安全问题</li>
<li>关于servlet随着项目的启动而创建</li>
<li>两种路径匹配方式</li>
<li>关于tomcat的目录下的web.xml配置(了解)</li>
</ul>
</li>
</ul>
</li>
<li>Filter
<ul>
<li>实现方式</li>
</ul>
</li>
<li>Response &amp; Request
<ul>
<li>response</li>
<li>request对象
<ul>
<li>获得表单提交的参数</li>
</ul>
</li>
<li>request域的应用</li>
<li>请求转发与请求包含
<ul>
<li>语法</li>
<li>转发</li>
<li>包含</li>
<li>请求转发与请求包含的区别</li>
<li>请求转发和重定向的的区别</li>
</ul>
</li>
</ul>
</li>
<li>Web服务器 - Tomcat
<ul>
<li>Tomcat架构图</li>
<li>Tomcat使用
<ul>
<li>配置虚拟目录</li>
<li>修改tomcat的端口号</li>
<li>配置虚拟主机：</li>
</ul>
</li>
<li>JavaWeb路径问题</li>
<li>使用相对路径解决路径写死问题</li>
</ul>
</li>
</ul>
<!-- raw HTML omitted -->
<h2 id="servlet">Servlet</h2>
<blockquote>
<p>Server Applet是运行在web服务器端容器(tomcat)中一个特殊的java小应用程序，用来接收请求，处理请求，生成响应。</p>
</blockquote>
<h3 id="实现方式">实现方式</h3>
<p>实现 Servlet 的三种方式:</p>
<ol>
<li>实现javax.servlet.Servlet接口；</li>
<li>继承javax.servlet.GenericServlet类；</li>
<li>继承javax.servlet.http.HttpServlet类；</li>
</ol>
<p>第一种方式实现sevlet接口，需要实现该接口中的五个方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> a_servlet_interface<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.ServletConfig<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.ServletException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.ServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.ServletResponse<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Servlet</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">/* 以下三个为servlet生命周期方法 */</span>

    <span style="color:#75715e">/*出生
</span><span style="color:#75715e">     * 1.该方法由系统调用，构造方法调用之后首次调用，对该Servlet进行初始化；
</span><span style="color:#75715e">     * 2.整个生命周期只会被调用一次，可以将资源打开等操作置于其中；
</span><span style="color:#75715e">     * 3.ServletConfig参数由系统创建。在该类其他方法中如果要使用，
</span><span style="color:#75715e">     * 要先定义一个实例变量，并将该参数传递给该实例变量。
</span><span style="color:#75715e">     * */</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">(</span>ServletConfig var1<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">;</span>

    <span style="color:#75715e">/*使命
</span><span style="color:#75715e">     * 1.该方法对请求进行处理，其实现基于多线程；
</span><span style="color:#75715e">     * 2.Servlet对象是单例的；
</span><span style="color:#75715e">     * 3.ServletRequest参数封装了客户端的请求内容，servletResponse对象
</span><span style="color:#75715e">     * 封装了响应内容，这两个对象有系统创建。*/</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>ServletRequest var1<span style="color:#f92672">,</span> ServletResponse var2<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException<span style="color:#f92672">;</span>

    <span style="color:#75715e">/*销毁
</span><span style="color:#75715e">     *该方法在此servlet类的生命周期结束前被调用。当服务器关闭时，销毁servlet，
</span><span style="color:#75715e">     *在销毁之前调用释放资源。*/</span>
    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">();</span>

    <span style="color:#75715e">/*ServletConfig是描述Servlet的配置信息的类，该类的对象由Servlet容器创建。
</span><span style="color:#75715e">     *通过该方法可以获取到这个对象 。*/</span>
    ServletConfig <span style="color:#a6e22e">getServletConfig</span><span style="color:#f92672">();</span>

    <span style="color:#75715e">/*通过该方法可以获取到servlet的信息（作者，版本 ，版权），基本没用。*/</span>
    String <span style="color:#a6e22e">getServletInfo</span><span style="color:#f92672">();</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>第二种方式继承javax.servlet.GenericServlet类
该类实现了ServletConfig、Servlet、Serializable三个接口，并且替我们保存了ServletConfig对象。注意: 不要重写servlet接口中的init方法，该类第一步已优化，如果要做初始化的动作,需要去重写GenericServlet提供的空参init方法。
源码：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> b_genericServlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.Serializable<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.Enumeration<span style="color:#f92672">;</span>

<span style="color:#75715e">/*优化1,帮我们保管ServletConfig对象；优化2，为调用方便，实现了ServletConfig接口*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GenericServlet</span> <span style="color:#66d9ef">implements</span> Servlet<span style="color:#f92672">,</span> ServletConfig<span style="color:#f92672">,</span> Serializable <span style="color:#f92672">{</span>
    <span style="color:#75715e">//被transient关键字修饰的变量不参与序列化，从而可以保护隐私
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">transient</span> ServletConfig config<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">GenericServlet</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">//实现servletConfig中的方法
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getInitParameter</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletConfig</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getInitParameter</span><span style="color:#f92672">(</span>name<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> Enumeration <span style="color:#a6e22e">getInitParameterNames</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletConfig</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getInitParameterNames</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> ServletConfig <span style="color:#a6e22e">getServletConfig</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">config</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> ServletContext <span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletConfig</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getServletInfo</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">(</span>ServletConfig config<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//子类直接重写接口中的init的方法会把this.config = arg0;
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">config</span> <span style="color:#f92672">=</span> config<span style="color:#f92672">;</span>
        <span style="color:#75715e">//代码覆盖,所以要提供一个空参init方法用来初始化动作
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">init</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">log</span><span style="color:#f92672">(</span>String msg<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">().</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> msg<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">log</span><span style="color:#f92672">(</span>String message<span style="color:#f92672">,</span> Throwable t<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">().</span><span style="color:#a6e22e">log</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> message<span style="color:#f92672">,</span> t<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">//service方法处理业务,声明为抽象方法,由子类自己实现
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>ServletRequest var1<span style="color:#f92672">,</span> ServletResponse var2<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getServletName</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">config</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getServletName</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>第三种方式继承javax.servlet.http.HttpServlet类（该类只能针对http请求协议的Servlet类)</p>
<ul>
<li>该类继承了GenericServlet类:</li>
<li>因为web项目基于HTTP协议，所以Service方法中传过来的request,response对象都是基于HTTP协议的，即HttpServletReueqst和HttpServletResponse，它帮我们进行了强转;</li>
<li>我们有可能在不同的请求方式时做不同的事情，根据请求方式不同，调用不同的方法，这些方法需要我们重写，否则调用未被重写的方法会返回405(不支持客户端以此种方式访问)。
i.e. GET &ndash;&gt; doGet()     POST &ndash;&gt; doPost()
HttpServletDemo：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> c_httpServlet<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.GenericServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.ServletException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.ServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.ServletResponse<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletResponse<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HttpServletDemo</span> <span style="color:#66d9ef">extends</span> GenericServlet <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String Method_GET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GET&#34;</span><span style="color:#f92672">;</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String Method_POST <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;POST&#34;</span><span style="color:#f92672">;</span>
  <span style="color:#a6e22e">@Override</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>ServletRequest req<span style="color:#f92672">,</span> ServletResponse resp<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
    <span style="color:#75715e">//优化1：将request和response强转成HTTP的.
</span><span style="color:#75715e"></span>    HttpServletRequest request <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    HttpServletResponse response <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
      request <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>HttpServletRequest<span style="color:#f92672">)</span> req<span style="color:#f92672">;</span>
      response <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>HttpServletResponse<span style="color:#f92672">)</span> resp<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    
    <span style="color:#f92672">}</span>
    service<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span>response<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">service</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
    <span style="color:#75715e">//优化2: 根据请求方式的不同，做不同的事
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//获得客户端的请求方式
</span><span style="color:#75715e"></span>    String method <span style="color:#f92672">=</span> req<span style="color:#f92672">.</span><span style="color:#a6e22e">getMethod</span><span style="color:#f92672">();</span><span style="color:#75715e">//GET/POST
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//根据请求方式不同,调用不同的方法
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>method<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>Method_GET<span style="color:#f92672">)){</span>
      doGet<span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>method<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>Method_POST<span style="color:#f92672">)){</span>
      doPost<span style="color:#f92672">(</span>req<span style="color:#f92672">,</span>resp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span> 
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest req<span style="color:#f92672">,</span> HttpServletResponse resp<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="sevletconfig--servletcontext">SevletConfig &amp; ServletContext</h3>
<h4 id="servletconfig">ServletConfig</h4>
<blockquote>
<p>封装了Servlet在web.xml中配置的初始化信息</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;init-param&gt;</span>
    <span style="color:#f92672">&lt;param-name&gt;</span>name<span style="color:#f92672">&lt;/param-name&gt;</span>
    <span style="color:#f92672">&lt;param-value&gt;</span>tom<span style="color:#f92672">&lt;/param-value&gt;</span>
<span style="color:#f92672">&lt;/init-param&gt;</span>
</code></pre></div><ol>
<li>getServletName获得配置文件中 <code>&lt;servlet-name&gt;</code> 元素的内容</li>
<li>getInitParameter根据 <code>&lt;init-param&gt;</code>中的 <code>&lt;param-name&gt;</code> 获得 <code>&lt;param-value&gt;</code></li>
<li>getInitParameterNames返回所有<code>&lt;param-name&gt;</code></li>
<li>getServletContext获得ServletContext对象</li>
</ol>
<h4 id="servletcontext">ServletContext</h4>
<blockquote>
<p>服务器会为每个应用创建有且只有一个的ServletContext对象，该对象封装了web.xml中的配置，并对于整个web应用可见。此对象在服务器启动时创建，在服务器关闭时销毁</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- web.xml配置 --&gt;</span>
<span style="color:#f92672">&lt;context-param&gt;</span>
    <span style="color:#f92672">&lt;param-name&gt;</span>name<span style="color:#f92672">&lt;/param-name&gt;</span>
    <span style="color:#f92672">&lt;param-value&gt;</span>jerry<span style="color:#f92672">&lt;/param-value&gt;</span>
<span style="color:#f92672">&lt;/context-param&gt;</span>
<span style="color:#f92672">&lt;context-param&gt;</span>
    <span style="color:#f92672">&lt;param-name&gt;</span>password<span style="color:#f92672">&lt;/param-name&gt;</span>
    <span style="color:#f92672">&lt;param-value&gt;</span>1234<span style="color:#f92672">&lt;/param-value&gt;</span>
<span style="color:#f92672">&lt;/context-param&gt;</span>
</code></pre></div><ol>
<li>通过ServletConfig对象中的getServletContext()方法获得此对象</li>
<li>获取web.xml中的配置信息的方法：
<ul>
<li>getInitParameterNames()获得所有键</li>
<li>getInitParameter(key)根据键获得对应的值</li>
</ul>
</li>
<li>ServletContext对应着Application域，利用了一个项目中只有一个ServletContext实例的特点，在servletContext中放置了一个map用作数据通信。这个Map就是所谓的域，因此所有的域对象都有存取数据的功能</li>
<li>获得项目中资源，eclipse工程下的文件路径与真正要操作的部署到Tomcat下的资源文件路径要注意区别</li>
</ol>
<p><strong>Demo</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#75715e">//获得全局 init param配置
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//1.获得servletContext
</span><span style="color:#75715e"></span>    ServletContext sc <span style="color:#f92672">=</span> getServletContext<span style="color:#f92672">();</span>
    <span style="color:#75715e">//2.操作map
</span><span style="color:#75715e"></span>    sc<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bag&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Incase&#34;</span><span style="color:#f92672">);</span>
    sc<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;car&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;BMW&#34;</span><span style="color:#f92672">);</span>
    sc<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;passport&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;HAWAII&#34;</span><span style="color:#f92672">);</span>

    String bag <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>String<span style="color:#f92672">)</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bag&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//输出到客户端
</span><span style="color:#75715e"></span>    response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span>bag<span style="color:#f92672">);</span>
    <span style="color:#75715e">//删除
</span><span style="color:#75715e"></span>    sc<span style="color:#f92672">.</span><span style="color:#a6e22e">removeAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bag&#34;</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">//3.调用getxxx方法
</span><span style="color:#75715e"></span>    Enumeration<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> en <span style="color:#f92672">=</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">getInitParameterNames</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>en<span style="color:#f92672">.</span><span style="color:#a6e22e">hasMoreElements</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        String key <span style="color:#f92672">=</span> en<span style="color:#f92672">.</span><span style="color:#a6e22e">nextElement</span><span style="color:#f92672">();</span>
        String value <span style="color:#f92672">=</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">getInitParameter</span><span style="color:#f92672">(</span>key<span style="color:#f92672">);</span>
        response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span>key <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;===&gt;&#34;</span> <span style="color:#f92672">+</span> value <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&lt;br/&gt;&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
</code></pre></div><h4 id="servlet中对象的范围">Servlet中对象的范围</h4>
<ul>
<li>servlet - 项目启动期间，一个servlet只有一个servlet实例</li>
<li>request - 项目启动期间，request对象的数量取决于当前有多少个请求正在处理</li>
<li>response - 项目启动期间，response对象的数量取决于当前有多少个请求正在处理</li>
<li>servletConfig - 一个servlet实例对应一个servletConfig对象</li>
<li>servletContext - 整个项目中只有一个servletContext实例存在</li>
</ul>
<h3 id="servlet类三大域及三大组件">Servlet类三大域及三大组件</h3>
<h4 id="三大域">三大域：</h4>
<ul>
<li>application — servletContext，范围是整个项目，只有一个servletContext对象，并且所有servlet的组件都能访问到。应用：保存全局的配置</li>
<li>session — HttpSession，范围是一次会话（没有保存sessionID的浏览器连接到服务器就会开启一个会话），有多少个浏览器访问就至少有多少个session。应用：购物车,验证码,登录信息</li>
<li>request — HttpServletRequest，范围是一次请求，当前有多少个请求正在处理就存在几个request域。应用：转发中共享数据</li>
</ul>
<p>关于域的4个操作：</p>
<ul>
<li><code>void setAttribute(String name, Object value)</code>: 存储一个域属性</li>
<li><code>Object getAttribute(String name)</code>: 获取数据</li>
<li><code>void removeAttribute(String name)</code>: 移除域属性</li>
<li><code>Enumeration getAttributeNames()</code>: 获得所有域属性名称</li>
</ul>
<p>三大域对象的生命周期长度：
request &lt; session &lt; application</p>
<h4 id="扩展">扩展</h4>
<ul>
<li>javaweb四大域（PageContext、ServletRequest、HttpSession、ServletContext）</li>
<li>jsp四大域（page、request、session、application）</li>
<li>jsp九大内置对象</li>
</ul>
<h3 id="servlet中的其他细节">Servlet中的其他细节</h3>
<h4 id="如何把一个servlet类映射成一个对外可访问的路径">如何把一个Servlet类映射成一个对外可访问的路径？</h4>
<ol>
<li>在web.xml中对该Servlet类进行注册并映射，即添加一个<code>&lt;servlet&gt;</code>元素</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;servlet&gt;</span>
  <span style="color:#75715e">&lt;!-- 注册别名常用类名（不包括包名）来命名，在web.xml中不可以有相同的注册命名 --&gt;</span>
  <span style="color:#f92672">&lt;servlet-name&gt;</span>注册别名<span style="color:#f92672">&lt;/servlet-name &gt;</span>
  <span style="color:#f92672">&lt;servlet-class&gt;</span>servlet类的完整路径名<span style="color:#f92672">&lt;/servlet-class&gt;</span>
<span style="color:#f92672">&lt;/servlet&gt;</span>
</code></pre></div><ol start="2">
<li>对前面注册的那个servlet类进行路径映射，即在<code>&lt;servlet&gt;</code>元素的下添加<code>&lt;servlet-mapping&gt;</code>元素</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;servelt-mapping&gt;</span>
    <span style="color:#f92672">&lt;servlet-name&gt;</span>
        已注册别名（根据servlet的别名找到对应的Servlet类，并执行该类中的service方法 ）
    <span style="color:#f92672">&lt;/servlet-name &gt;</span>
    <span style="color:#f92672">&lt;url-pattern&gt;</span>
        该servlet类对象访问所映射的路径（该元素的值必须要以“/”开头，表示相对于本项目的根目录 ）
    <span style="color:#f92672">&lt;/url-pattern&gt;</span>
<span style="color:#f92672">&lt;/servlet-mapping&gt;</span>
</code></pre></div><p>web.xml是项目的核心配置文件。项目被加载后，首先执行该web.xml文件，针对每一个servlet-mapping元素创建一个对应的实例。</p>
<h4 id="关于servlet线程安全问题">关于Servlet线程安全问题</h4>
<blockquote>
<p>因为在servlet运行期间只有一个servlet实例存在，可能会同时处理多个请求，那么我们在servlet中声明成员变量来存储用户数据是有线程安全问题的</p>
</blockquote>
<p>有两种解决方法，推荐使用第一种方法：</p>
<ol>
<li>使用局部变量保存用户数据</li>
<li>实现SingleThreadModel</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServletSafe</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#66d9ef">implements</span> SingleThreadModel <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span>0 <span style="color:#f92672">;</span>
  
  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
      i<span style="color:#f92672">++;</span>
      <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>5000<span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
      <span style="color:#f92672">}</span>
      response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;number is&#34;</span><span style="color:#f92672">+</span>i<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>

  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="关于servlet随着项目的启动而创建">关于servlet随着项目的启动而创建</h4>
<blockquote>
<p>使用<code>&lt;load-on-startup&gt;</code>配置来实现。在其中填写一个整数，正数值就表示该Servlet对象会在web.xml被加载的时候就被创建了，负数值表示在用户的第一次请求时被创建。当整数大于0时，整数越小优先级越高，如果优先级一样，启动顺序按照配置顺序。</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;servlet&gt;</span>
     <span style="color:#f92672">&lt;servlet-name&gt;</span>AServlet<span style="color:#f92672">&lt;/servlet-name&gt;</span>
     <span style="color:#f92672">&lt;servlet-class&gt;</span>servlet.AServlet<span style="color:#f92672">&lt;/servlet-class&gt;</span>
     <span style="color:#f92672">&lt;load-on-startup&gt;</span>3<span style="color:#f92672">&lt;/load-on-startup&gt;</span>                  
 <span style="color:#f92672">&lt;/servlet&gt;</span>
</code></pre></div><h4 id="两种路径匹配方式">两种路径匹配方式</h4>
<p><code>&lt;url-pattern&gt;</code>路径匹配:</p>
<pre><code>/AServlet - http://localhost:8080/webproject/AServlet
/ABC/AServlet - http://localhost:8080/webproject/ABC/AServlet
/ABC/ABC/* - http://localhost:8080/webproject/ABC/ABC/oasdojasdjioasd
/* - http://localhost:8080/webproject/asdiojoiajsidojoasd
/ - /*         
</code></pre><p>后缀名匹配:</p>
<pre><code>*.do ==&gt; struts
*.action ==&gt; struts2
*.html ==&gt;
</code></pre><p>注意:</p>
<ol>
<li>关于路径，配置的路径匹配范围越大优先级越低</li>
<li>两种匹配模式不能混用，例如错误的例子: /*.do</li>
</ol>
<h4 id="关于tomcat的目录下的webxml配置了解">关于tomcat的目录下的web.xml配置(了解)</h4>
<ol>
<li>default servlet的配置</li>
<li>jsp servlet的配置</li>
<li>互联网中所有mime类型</li>
<li>欢迎页面配置</li>
<li>设置失效时间</li>
</ol>
<pre><code>&lt;session-config&gt;
    &lt;session-timeout&gt;30&lt;/session-timeout&gt;
&lt;/session-config&gt;
</code></pre><h2 id="filter">Filter</h2>
<blockquote>
<p>可以实现动态拦截请求和响应。</p>
</blockquote>
<h3 id="实现方式-1">实现方式</h3>
<p>Filter技术可以实现用户在访问某个目标资源之前，对访问的请求和响应进行拦截，并且能够拦截web服务器管理的所有资源，从而实现一些特殊的功能，如实现URL级别的权限访问控制、过滤敏感词汇、压缩响应信息等。</p>
<p>原理：Filter接口中有一个doFilter方法，当我们编写好Filter，并配置对哪个web资源进行拦截后，WEB服务器每次在调用web资源的service方法之前，都会先调用一下filter的doFilter方法，因此，在该方法内编写代码可达到如下目的：</p>
<ol>
<li>在客户端的请求访问WEB资源之前，拦截这些请求</li>
<li>决定是否让用户访问WEB资源，即调用filterChain.doFilter()方法</li>
<li>在服务器的响应发送回客户端之前，处理这些响应</li>
</ol>
<p><strong>FilterChain类</strong>：在一个web应用中，可以开发编写多个Filter，这些Filter组合起来称之为一个Filter链。Web服务器根据Filter在web.xml文件中的注册顺序决定调用Filter的顺序，当第一个Filter的doFilter方法被调用时，Web服务器会创建一个代表Filter链的FilterChain对象传递给该方法。在doFilter方法中，开发人员如果调用了FilterChain对象的doFilter方法，则web服务器会检查FilterChain对象中是否还有filter，如果有，则调用第2个filter，如果没有，则调用目标资源。</p>
<p>Filter实现:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> Filter<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.Enumeration<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * 在让目标资源执行之前，可以对request\response作预处理，再让目标资源执行
</span><span style="color:#75715e"> * 在目标资源执行之后，可以捕获目标资源的执行结果，从而实现一些特殊的功能
</span><span style="color:#75715e"> * 在filter中根据条件决定是否调用chain.doFilter(request, response)方法，即是否让目标资源执行
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FilterDemo</span> <span style="color:#66d9ef">implements</span> Filter <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#75715e">// Filter的创建和销毁由WEB服务器负责
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">init</span><span style="color:#f92672">(</span>FilterConfig filterConfig<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ServletException <span style="color:#f92672">{</span>
        <span style="color:#75715e">/*web应用程序启动时，web服务器将创建Filter的实例对象，并调用其init方法，完成对象的初始化功能，从而为后续的用户请求作好拦截的准备工作
</span><span style="color:#75715e">         * Filter对象只会创建一次，init方法也只会执行一次。
</span><span style="color:#75715e">         * 通过init方法的参数，可获得代表当前filter配置信息的FilterConfig对象。*/</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Filter初始化...&#34;</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">//利用FilterConfig得到filter配置信息
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//得到过滤器的名字
</span><span style="color:#75715e"></span>        String filterName <span style="color:#f92672">=</span> filterConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">getFilterName</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">//得到在web.xml文件中配置的初始化参数值，如果不存在返回null
</span><span style="color:#75715e"></span>        String initParam1 <span style="color:#f92672">=</span> filterConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">getInitParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">);</span>
        String initParam2 <span style="color:#f92672">=</span> filterConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">getInitParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hobby&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>filterName<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>initParam1<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>initParam2<span style="color:#f92672">);</span>

        <span style="color:#75715e">//返回Filter的所有初始化参数的名字的枚举集合
</span><span style="color:#75715e"></span>        Enumeration<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> initParamterNames <span style="color:#f92672">=</span> filterConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">getInitParameterNames</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>initParamterNames<span style="color:#f92672">.</span><span style="color:#a6e22e">hasMoreElements</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            String paramName <span style="color:#f92672">=</span> initParamterNames<span style="color:#f92672">.</span><span style="color:#a6e22e">nextElement</span><span style="color:#f92672">();</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>paramName<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">//返回Servlet上下文对象的引用：public ServletContext getServletContext()
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>ServletRequest servletRequest<span style="color:#f92672">,</span> ServletResponse servletResponse<span style="color:#f92672">,</span> FilterChain filterChain<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException<span style="color:#f92672">,</span> ServletException <span style="color:#f92672">{</span>
        <span style="color:#75715e">// 对request和response进行一些预处理
</span><span style="color:#75715e"></span>        servletRequest<span style="color:#f92672">.</span><span style="color:#a6e22e">setCharacterEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
        servletResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">setCharacterEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
        servletResponse<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=UTF-8&#34;</span><span style="color:#f92672">);</span>

        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;FilterDemo执行前...&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//调用该方法则web服务器就会调用web资源的service方法，即web资源就会被访问
</span><span style="color:#75715e"></span>        filterChain<span style="color:#f92672">.</span><span style="color:#a6e22e">doFilter</span><span style="color:#f92672">(</span>servletRequest<span style="color:#f92672">,</span> servletResponse<span style="color:#f92672">);</span> <span style="color:#75715e">//让目标资源执行，即放行
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;FilterDemo执行后...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">/*Web容器调用destroy方法销毁Filter。
</span><span style="color:#75715e">         * destroy方法在Filter的生命周期中仅执行一次。
</span><span style="color:#75715e">         * 在destroy方法中，可以释放过滤器使用的资源。*/</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Filter销毁...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>在web. xml中配置过滤器：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;web-app</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
         <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&#34;</span>
         <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;4.0&#34;</span><span style="color:#f92672">&gt;</span>

    <span style="color:#75715e">&lt;!-- 当Web容器启动Web应用程序时会为你在部署描述符中声明的每一个过滤器创建一个实例 --&gt;</span>
    <span style="color:#75715e">&lt;!-- Filter的执行顺序与在web.xml配置文件中的配置顺序一致 --&gt;</span>
    <span style="color:#75715e">&lt;!-- 一般把Filter配置在所有的Servlet之前。 --&gt;</span>
    <span style="color:#75715e">&lt;!--配置Filter--&gt;</span>
    <span style="color:#f92672">&lt;filter&gt;</span>
        <span style="color:#f92672">&lt;filter-name&gt;</span>FilterDemo<span style="color:#f92672">&lt;/filter-name&gt;</span>
        <span style="color:#f92672">&lt;filter-class&gt;</span>Filter.FilterDemo<span style="color:#f92672">&lt;/filter-class&gt;</span>
        <span style="color:#75715e">&lt;!--为过滤器指定初始化参数--&gt;</span>
        <span style="color:#f92672">&lt;init-param&gt;</span>
            <span style="color:#75715e">&lt;!--添加描述信--&gt;</span>
            <span style="color:#f92672">&lt;description&gt;</span>姓名<span style="color:#f92672">&lt;/description&gt;</span>
            <span style="color:#f92672">&lt;param-name&gt;</span>name<span style="color:#f92672">&lt;/param-name&gt;</span>
            <span style="color:#f92672">&lt;param-value&gt;</span>wyj<span style="color:#f92672">&lt;/param-value&gt;</span>
        <span style="color:#f92672">&lt;/init-param&gt;</span>
        <span style="color:#f92672">&lt;init-param&gt;</span>
            <span style="color:#f92672">&lt;description&gt;</span>爱好<span style="color:#f92672">&lt;/description&gt;</span>
            <span style="color:#f92672">&lt;param-name&gt;</span>hobby<span style="color:#f92672">&lt;/param-name&gt;</span>
            <span style="color:#f92672">&lt;param-value&gt;</span>coding<span style="color:#f92672">&lt;/param-value&gt;</span>
        <span style="color:#f92672">&lt;/init-param&gt;</span>
    <span style="color:#f92672">&lt;/filter&gt;</span>


    <span style="color:#75715e">&lt;!--映射过滤器，即设置一个Filter所负责拦截的资源--&gt;</span>
    <span style="color:#75715e">&lt;!--一个Filter拦截的资源可通过两种方式来指定：Servlet名称或资源访问的请求路径--&gt;</span>
    <span style="color:#f92672">&lt;filter-mapping&gt;</span>
        <span style="color:#75715e">&lt;!--设置filter的注册名称--&gt;</span>
        <span style="color:#f92672">&lt;filter-name&gt;</span>FilterDemo<span style="color:#f92672">&lt;/filter-name&gt;</span>
        <span style="color:#75715e">&lt;!--设置filter所拦截的请求路径，&#34;/*&#34;表示拦截所有请求--&gt;</span>
        <span style="color:#f92672">&lt;url-pattern&gt;</span>/*<span style="color:#f92672">&lt;/url-pattern&gt;</span>
        <span style="color:#75715e">&lt;!--&lt;servlet-name&gt;指定过滤器所拦截的Servlet名称--&gt;</span>
        <span style="color:#75715e">&lt;!--指定过滤器所拦截的资源被Servlet容器调用的方式，可设置多个，默认REQUEST--&gt;</span>
        <span style="color:#f92672">&lt;dispatcher&gt;</span>REQUEST<span style="color:#f92672">&lt;/dispatcher&gt;</span>
        <span style="color:#f92672">&lt;dispatcher&gt;</span>FORWARD<span style="color:#f92672">&lt;/dispatcher&gt;</span>
    <span style="color:#f92672">&lt;/filter-mapping&gt;</span>
<span style="color:#f92672">&lt;/web-app&gt;</span>
</code></pre></div><p><code>&lt;dispatcher&gt;</code> 子元素可以设置的值及其意义：</p>
<ol>
<li>REQUEST：当用户直接访问页面时，Web容器将会调用过滤器。如果目标资源是通过RequestDispatcher的include()或forward()方法访问时，那么该过滤器就不会被调用。</li>
<li>INCLUDE：如果目标资源是通过RequestDispatcher的include()方法访问时，那么该过滤器将被调用。除此之外，该过滤器不会被调用。</li>
<li>FORWARD：如果目标资源是通过RequestDispatcher的forward()方法访问时，那么该过滤器将被调用，除此之外，该过滤器不会被调用。</li>
<li>ERROR：如果目标资源是通过声明式异常处理机制调用时，那么该过滤器将被调用。除此之外，过滤器不会被调用。</li>
</ol>
<h2 id="response--request">Response &amp; Request</h2>
<h3 id="response">response</h3>
<p>HTTP响应</p>
<ul>
<li>响应首行：协议/版本号  状态码  状态码描述</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//添加状态码和描述：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setStatus</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> sc<span style="color:#f92672">)</span>  <span style="color:#75715e">//只设置状态码 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setStatus</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> sc<span style="color:#f92672">,</span> String sm<span style="color:#f92672">)</span>  <span style="color:#75715e">//设置状态码和描述
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendError</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> sc<span style="color:#f92672">)</span>  <span style="color:#75715e">//只设置状态码,错误的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendError</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> sc<span style="color:#f92672">,</span> String msg<span style="color:#f92672">)</span>  <span style="color:#75715e">//设置状态码和描述
</span></code></pre></div><ul>
<li>响应头</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//添加响应头
</span><span style="color:#75715e">//设置响应头，如果key一样会覆盖
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">,</span> String value<span style="color:#f92672">)</span> 
setIntHeader<span style="color:#f92672">(</span>String name<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> value<span style="color:#f92672">)</span>
setDateHeader<span style="color:#f92672">(</span>String name<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> date<span style="color:#f92672">)</span>
<span style="color:#75715e">//设置响应头，无论如何都新增
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addHeader</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">,</span> String value<span style="color:#f92672">)</span> 
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addIntHeader</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> value<span style="color:#f92672">)</span>
<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addDateHeader</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> date<span style="color:#f92672">)</span>
</code></pre></div><ul>
<li>响应空行</li>
<li>响应正文</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">getOutputStream <span style="color:#75715e">//发送字节流
</span><span style="color:#75715e"></span>getWriter <span style="color:#75715e">//发送字符流
</span></code></pre></div><p>应用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//例1：手动向浏览器发送404
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">sendError</span><span style="color:#f92672">(</span>404<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;未找到&#34;</span><span style="color:#f92672">);</span>

<span style="color:#75715e">//例2：重定向
</span><span style="color:#75715e">//1.返回状态码为302
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setStatus</span><span style="color:#f92672">(</span>302<span style="color:#f92672">);</span>
<span style="color:#75715e">//2.告诉浏览器去哪找新的地址  发送一个响应头: Location : http://www.baidu.com
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Location&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;www.baidu.com&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//相当于：
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">sendRedirect</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;www.baidu.com&#34;</span><span style="color:#f92672">);</span>

<span style="color:#75715e">//例3：Refresh头，刷新
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span><span style="color:#75715e">//解决乱码
</span><span style="color:#75715e">//1.设置响应头为Refresh:5;url=https://w-yj.github.io/Day08-response/AServlet
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Refresh&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;5;url=https://w-yj.github.io/RequestAndResponse/AServlet&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//2.使用字符流发送提示,5秒后跳转
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span>
<span style="color:#e6db74">&#34;您将在&lt;span id=&#39;one&#39;&gt;&lt;/span&gt;秒后跳转到AServlet!&#34;</span> <span style="color:#f92672">+</span>
<span style="color:#e6db74">&#34;&lt;script type=&#39;text/javascript&#39;&gt;&#34;</span> <span style="color:#f92672">+</span>
  <span style="color:#e6db74">&#34;var count = 5;&#34;</span> <span style="color:#f92672">+</span> 
  <span style="color:#e6db74">&#34;function fun1(){&#34;</span> <span style="color:#f92672">+</span> 
    <span style="color:#e6db74">&#34;var span = document.getElementById(&#39;one&#39;);&#34;</span> <span style="color:#f92672">+</span>
    <span style="color:#e6db74">&#34;span.innerHTML = count--;&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">+</span>  
    <span style="color:#e6db74">&#34;if(count&gt;0){&#34;</span> <span style="color:#f92672">+</span> 
      <span style="color:#e6db74">&#34;window.setTimeout(fun1,1000);&#34;</span> <span style="color:#f92672">+</span>  
    <span style="color:#e6db74">&#34;}&#34;</span> <span style="color:#f92672">+</span>
  <span style="color:#e6db74">&#34;}&#34;</span> <span style="color:#f92672">+</span> 
  <span style="color:#e6db74">&#34;fun1();&#34;</span> <span style="color:#f92672">+</span> 
<span style="color:#e6db74">&#34;&lt;/script&gt;&#34;</span><span style="color:#f92672">);</span>

<span style="color:#75715e">//例4：发送字节，发送中文.
</span><span style="color:#75715e">//1.获得输出字节流
</span><span style="color:#75715e"></span>OutputStream os <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">();</span>
<span style="color:#75715e">//2.输出中文
</span><span style="color:#75715e"></span>os<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;你好 世界!&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">));</span>
<span style="color:#75715e">//如果告诉浏览器使用GBK解码会出现乱码
</span><span style="color:#75715e">//os.write(&#34;&lt;meta http-equiv=&#39;Content-Type&#39; content=&#39;text/html;charset=gbk&#39;&gt;&#34;.getBytes());
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Content-Type&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>

<span style="color:#75715e">//例5：发送字符流，发送中文.
</span><span style="color:#75715e">//控制字符流使用的编码。往上放，在获得字符流时会来取这个编码，如果取完之后设置则没有效果
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setCharacterEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//告诉浏览器使用什么码表解码
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Content-Type&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//JAVAEE提供了一个方法,这个方法同时可以做以上两件事.
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//1.获得字符流
</span><span style="color:#75715e"></span>PrintWriter pw <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">();</span>
<span style="color:#75715e">//2.发送中文
</span><span style="color:#75715e"></span>pw<span style="color:#f92672">.</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;你好 世界!&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//问题: 同时使用两种流会出现问题
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">().</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;haha&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">());</span>
<span style="color:#75715e">//注意：字节流和字符流一定不能同时使用！
</span><span style="color:#75715e"></span>
<span style="color:#75715e">//例6：使用字节流发送图片
</span><span style="color:#75715e">//告诉浏览器发给你的流的MIME类型.
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;image/jpeg&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//1.获得图片的输入流
</span><span style="color:#75715e"></span>InputStream in <span style="color:#f92672">=</span> getServletContext<span style="color:#f92672">().</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/001.jpg&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//2.通过response获得输出字节流
</span><span style="color:#75715e"></span>OutputStream out <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">();</span>
<span style="color:#75715e">//3.两个对接
</span><span style="color:#75715e"></span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>1024<span style="color:#f92672">];</span>
<span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">((</span>len<span style="color:#f92672">=</span>in<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>buffer<span style="color:#f92672">))&gt;</span>0<span style="color:#f92672">){</span>
  out<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>buffer<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> len<span style="color:#f92672">);</span>
  out<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
in<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>

<span style="color:#75715e">//例7：使用字节流发送文件(文件下载)
</span><span style="color:#75715e">//告诉浏览器是什么
</span><span style="color:#75715e">//getServletContext().getMimeType(&#34;.jar&#34;) Context对象根据后缀名去web.xml查找mime类型。
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span>getServletContext<span style="color:#f92672">().</span><span style="color:#a6e22e">getMimeType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;.jar&#34;</span><span style="color:#f92672">));</span>
<span style="color:#75715e">//告诉浏览器推荐用户使用什么名称下载
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Content-Disposition&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;attachment;filename=ValidateCode.jar&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//1.获得输入流
</span><span style="color:#75715e"></span>InputStream in <span style="color:#f92672">=</span> getServletContext<span style="color:#f92672">().</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/ValidateCode.jar&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">//2.通过response获得输出字节流
</span><span style="color:#75715e"></span>OutputStream out <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">();</span>
<span style="color:#75715e">//3.两个对接
</span><span style="color:#75715e"></span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> buffer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>1024<span style="color:#f92672">];</span>
<span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">((</span>len<span style="color:#f92672">=</span>in<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>buffer<span style="color:#f92672">))&gt;</span>0<span style="color:#f92672">){</span>
  out<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>buffer<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> len<span style="color:#f92672">);</span>
  out<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
in<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
</code></pre></div><h3 id="request对象">request对象</h3>
<blockquote>
<p>封装了浏览器发送来的请求信息</p>
</blockquote>
<p>HTTP请求</p>
<ul>
<li>请求首行：请求方式     请求路径     协议/版本号</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">request<span style="color:#f92672">.</span><span style="color:#a6e22e">getMethod</span><span style="color:#f92672">()</span> <span style="color:#75715e">// GET
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestURI</span><span style="color:#f92672">()</span> <span style="color:#75715e">// /Day08-request/AServlet
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletPath</span><span style="color:#f92672">()</span> <span style="color:#75715e">// /AServlet
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getContextPath</span><span style="color:#f92672">()</span> <span style="color:#75715e">// /Day08-request
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getScheme</span><span style="color:#f92672">()</span> <span style="color:#75715e">// http
</span></code></pre></div><ul>
<li>请求头</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//原始方式获得请求头
</span><span style="color:#75715e"></span>String <span style="color:#a6e22e">getHeader</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> 
<span style="color:#66d9ef">long</span> <span style="color:#a6e22e">getDateHeader</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getIntHeader</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span>
Enumeration <span style="color:#a6e22e">getHeaders</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span>
Enumeration <span style="color:#a6e22e">getHeaderNames</span><span style="color:#f92672">()</span>

<span style="color:#75715e">//javaee封装好的方法
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getContentLength</span><span style="color:#f92672">()</span> <span style="color:#75715e">// -1
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getContentType</span><span style="color:#f92672">()</span> <span style="color:#75715e">// null
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getLocale</span><span style="color:#f92672">()</span> <span style="color:#75715e">// zh_CN
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getQueryString</span><span style="color:#f92672">()</span> <span style="color:#75715e">// name=tom&amp;age=18
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRemoteAddr</span><span style="color:#f92672">()</span> <span style="color:#75715e">// 0:0:0:0:0:0:0:1
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRemoteHost</span><span style="color:#f92672">()</span> <span style="color:#75715e">// 0:0:0:0:0:0:0:1
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRemotePort</span><span style="color:#f92672">()</span> <span style="color:#75715e">// 52074
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getServerName</span><span style="color:#f92672">()</span> <span style="color:#75715e">// localhost
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getServerPort</span><span style="color:#f92672">()</span> <span style="color:#75715e">// 8080
</span></code></pre></div><ul>
<li>请求空行</li>
<li>请求正文：表单传送过来的键值对</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> cn.servlet.request.info<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.ServletException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletResponse<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getContentLength(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getContentLength</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getContentType(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getContentType</span><span style="color:#f92672">());</span>
        <span style="color:#75715e">//request.getContextPath()返回部署的应用程序名或者是当前的项目名称
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getContextPath(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getContextPath</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getMethod(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getMethod</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getLocale(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getLocale</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getQueryString(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getQueryString</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getRequestURI(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestURI</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getRequestURL(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestURL</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getServletPath(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletPath</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getRemoteAddr(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRemoteAddr</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getRemoteHost(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRemoteHost</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getRemotePort(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRemotePort</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getScheme(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getScheme</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getServerName(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getServerName</span><span style="color:#f92672">());</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;request.getServerPort(): &#34;</span> <span style="color:#f92672">+</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getServerPort</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="获得表单提交的参数">获得表单提交的参数</h4>
<p>解决乱码:要确保编码和解码一致.</p>
<ul>
<li>浏览器编码使用的码表就是表单所在页面的码表</li>
<li>服务器解码请求默认使用ISO-8859-1解码，如下配置的URIEncoding来决定解码码表</li>
</ul>
<p>服务器端配置：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Connector</span> <span style="color:#a6e22e">port=</span><span style="color:#e6db74">&#34;8080&#34;</span>  <span style="color:#a6e22e">protocol=</span><span style="color:#e6db74">&#34;HTTP/1.1&#34;</span>  <span style="color:#a6e22e">URIEncoding=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>  <span style="color:#a6e22e">connectionTimeout=</span><span style="color:#e6db74">&#34;20000&#34;</span>  <span style="color:#a6e22e">redirectPort=</span><span style="color:#e6db74">&#34;8443&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><p>以上配置会影响整个服务器不推荐，我们使用如下代码解决:</p>
<p>doGet()方法中解决GET乱码（解码请求头）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//获得表单提交上来的键值对
</span><span style="color:#75715e"></span>String name <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">);</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">+</span> age<span style="color:#f92672">);</span>

<span style="color:#75715e">// doGet()方法中解决GET乱码
</span><span style="color:#75715e">// 1.获得参数
</span><span style="color:#75715e"></span>String name <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">// 2.因为服务器使用了错误的码表,那么我们按照错误的码表原路返回
</span><span style="color:#75715e"></span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> nameByte <span style="color:#f92672">=</span> name<span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ISO-8859-1&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">// 3.用正确的码表重新解码
</span><span style="color:#75715e"></span>String newName <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">(</span>nameByte<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;解决之后的:&#34;</span><span style="color:#f92672">+</span>newName<span style="color:#f92672">);</span>
</code></pre></div><p>doPost()方法中解决post乱码（解码请求体）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//post请求中，因为参数的解码时机在第一次调用getParameter之前，所以在调用该方法之前设置解码的码表即可。
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">setCharacterEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
String name <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">);</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>name<span style="color:#f92672">);</span>
</code></pre></div><p>涉及到获得表单参数的其他方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//String getParameter() 根据键获得值  
</span><span style="color:#75715e"></span>
<span style="color:#75715e">//String[] getParameterValues(String name) 根据键获得值，获得一键对应多个值的情况 
</span><span style="color:#75715e"></span>String<span style="color:#f92672">[]</span> habits <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameterValues</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;habit&#34;</span><span style="color:#f92672">);</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span>habits<span style="color:#f92672">));</span>
String habit  <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;habit&#34;</span><span style="color:#f92672">);</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getParameter获得多个值：&#34;</span><span style="color:#f92672">+</span>habit<span style="color:#f92672">);</span>

<span style="color:#75715e">//Map getParameterMap() 获得服务器保存表单参数的容器，即map&lt;String,String[]&gt;
</span><span style="color:#75715e"></span>Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span>String<span style="color:#f92672">[]&gt;</span> map <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameterMap</span><span style="color:#f92672">();</span>
<span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>Entry<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">[]&gt;</span>  en <span style="color:#f92672">:</span> map<span style="color:#f92672">.</span><span style="color:#a6e22e">entrySet</span><span style="color:#f92672">()){</span>
  String key <span style="color:#f92672">=</span> en<span style="color:#f92672">.</span><span style="color:#a6e22e">getKey</span><span style="color:#f92672">();</span>
  String<span style="color:#f92672">[]</span> value <span style="color:#f92672">=</span> en<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">();</span>
  System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>key<span style="color:#f92672">+</span><span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">+</span>Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span>value<span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">//Enumeration getParameterNames() 获得提交的所有键
</span><span style="color:#75715e"></span>Enumeration<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> en <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameterNames</span><span style="color:#f92672">();</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>en<span style="color:#f92672">.</span><span style="color:#a6e22e">hasMoreElements</span><span style="color:#f92672">()){</span>
      String key <span style="color:#f92672">=</span> en<span style="color:#f92672">.</span><span style="color:#a6e22e">nextElement</span><span style="color:#f92672">();</span>
      System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;提交上来的键：&#34;</span><span style="color:#f92672">+</span>key<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="request域的应用">request域的应用</h3>
<p>**原理：**在request对象中含有一个map，该map就是request域<br>
**作用：**实际开发中，使用请求转发时，servlet处理完逻辑，处理结果要交给jsp显示，可以使用request域将处理结果由servlet带给jsp显示<br>
**范围：**一个request对象对应一个request域(map)，系统当前有多少个request就有多少request域<br>
<strong>操作</strong></p>
<pre><code>setAttribute  存入一个键值对
getAttribute  通过键取出值
getAttributeNames 获得域中所有键
removeAttribute 跟据键移除一个键值对       
</code></pre><p><strong>应用</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 1.获得表单提交的用户名密码
</span><span style="color:#75715e"></span>String name <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">);</span>
String password <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">);</span>
Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span>String<span style="color:#f92672">&gt;</span> error <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;();</span>

<span style="color:#75715e">// 2.验证
</span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span><span style="color:#f92672">(!(</span>name<span style="color:#f92672">!=</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> name<span style="color:#f92672">.</span><span style="color:#a6e22e">trim</span><span style="color:#f92672">().</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()&gt;</span>0 <span style="color:#f92672">&amp;&amp;</span> name<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tom&#34;</span><span style="color:#f92672">))){</span>
  error<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;用户名有误!&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(!(</span>password<span style="color:#f92672">!=</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> password<span style="color:#f92672">.</span><span style="color:#a6e22e">trim</span><span style="color:#f92672">().</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()&gt;</span>0 <span style="color:#f92672">&amp;&amp;</span> password<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1234&#34;</span><span style="color:#f92672">))){</span>
  error<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;密码错误!&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// 3.将错误信息通过request域带到错误页面
</span><span style="color:#75715e"></span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;error&#34;</span><span style="color:#f92672">,</span>error <span style="color:#f92672">);</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>error<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">){</span>
  <span style="color:#75715e">// 失败：回到登录页面,并显示错误信息
</span><span style="color:#75715e"></span>  request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login2/login.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
  <span style="color:#75715e">// 成功：成功页面
</span><span style="color:#75715e"></span>  request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login2/success.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="请求转发与请求包含">请求转发与请求包含</h3>
<h4 id="语法">语法</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">RequestDispatcher rd <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/MyServlet&#34;</span><span style="color:#f92672">);</span>
</code></pre></div><p>使用👆的方法获取RequestDispathcher对象，参数为被包含或者被转发的目标Servlet路径。</p>
<p>若是请求转发：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">rd<span style="color:#f92672">.</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span>response<span style="color:#f92672">);</span>
</code></pre></div><p>若是请求包含：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">rd<span style="color:#f92672">.</span><span style="color:#a6e22e">include</span><span style="color:#f92672">(</span>resuest<span style="color:#f92672">,</span>response<span style="color:#f92672">);</span>
</code></pre></div><p>即可完成请求转发与请求包含。</p>
<h4 id="转发">转发</h4>
<blockquote>
<p>一个Servlet处理完毕交给下面的servlet(JSP)继续处理</p>
</blockquote>
<p>作用：实际开发中，没有servlet转发给servlet的情况，都是由servlet转发给JSP，这样可以达到分工的作用，servlet比较适合处理业务，JSP比较适合显示功能。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> cn.servlet.request.forward<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.ServletException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletResponse<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EServlet</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//Servlet中转发后不要做输出正文的动作，没有结果
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//如果放到前面可以但会出现乱码，但是响应头是可以设置
</span><span style="color:#75715e"></span>        response<span style="color:#f92672">.</span><span style="color:#a6e22e">setCharacterEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;utf-8&#34;</span><span style="color:#f92672">);</span>
        response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;哈哈哈&#34;</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">// 1.获得表单提交的用户名密码
</span><span style="color:#75715e"></span>        String name <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">);</span>
        String password <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">// 2.判断是否正确 tom 1234 才算成功
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>name <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> name<span style="color:#f92672">.</span><span style="color:#a6e22e">trim</span><span style="color:#f92672">().</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0 <span style="color:#f92672">&amp;&amp;</span> name<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;tom&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span>
                password <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> password<span style="color:#f92672">.</span><span style="color:#a6e22e">trim</span><span style="color:#f92672">().</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0 <span style="color:#f92672">&amp;&amp;</span> password<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;1234&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//成功：转发到成功页面
</span><span style="color:#75715e"></span>            request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login/success.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
            <span style="color:#75715e">//自己来做,很多弊端
</span><span style="color:#75715e"></span>          <span style="color:#75715e">/*AServlet a = new AServlet();
</span><span style="color:#75715e">            a.service(request, response);*/</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">//失败：转发到失败页面
</span><span style="color:#75715e"></span>            request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/login/error.jsp&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">forward</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>
        doGet<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="包含">包含</h4>
<blockquote>
<p>两个servlet(jsp)共同向浏览器输出内容</p>
</blockquote>
<p>作用：实际开发中，多个页面含有相同的内容，我们把相同的内容抽取到一个jsp中，在需要显示这个段内容的jsp中，包含抽取的jsp，可以达到统一管理相同的内容</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// GServlet doGet()
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;这是页脚部分&#34;</span><span style="color:#f92672">);</span>

<span style="color:#75715e">// FServlet doGet()
</span><span style="color:#75715e"></span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">setContentType</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span><span style="color:#f92672">);</span>
response<span style="color:#f92672">.</span><span style="color:#a6e22e">getWriter</span><span style="color:#f92672">().</span><span style="color:#a6e22e">print</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;这是正文部分&lt;hr&gt;&#34;</span><span style="color:#f92672">);</span>
request<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestDispatcher</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/GServlet&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">include</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
</code></pre></div><h4 id="请求转发与请求包含的区别">请求转发与请求包含的区别</h4>
<ul>
<li>请求转发：由当前Servlet设置响应头（不能设置响应体），下一个Servlet既可以设置响应头也可设置响应体。</li>
<li>请求包含：当前Servlet和下一个Servlet共同完成响应头和响应体。</li>
</ul>
<p>无论是请求转发还是请求包含，都在一个请求范围内，所以多个Servlet中使用的是同一个request和response</p>
<h4 id="请求转发和重定向的的区别">请求转发和重定向的的区别</h4>
<ol>
<li>请求转发是一个请求一次响应，而重定向是两次请求两次响应；</li>
<li>请求转发地址栏不变化，而重定向会显示后一个请求的地址；</li>
<li>请求转发只能转发到本项目其他Servlet，而重定向不只能重定向到本项目，而且还能定向到其他项目；</li>
<li>请求转发是服务器端行为，只需给出转发的Servlet路径，而重定向需要给出requestURI，即包含项目名；</li>
<li>请求转发比重定向效率高，因为请求转发只发出一个请求；</li>
<li>转发过程中只有一个request对象产生，重定向是两个；</li>
<li>重定向的第2个请求的请求方式是什么？get</li>
<li>转发中第2个servlet(jsp)是什么请求方式？第一个servlet是什么第2个就是什么</li>
</ol>
<p>此外，当项目中需要地址栏发生变化时，必须使用重定向；当需要在下一个Servlet中获取到request域中的数据时，必须使用请求转发。</p>
<h2 id="web服务器---tomcat">Web服务器 - Tomcat</h2>
<h3 id="tomcat架构图">Tomcat架构图</h3>
<p><img src="https://w-yj.github.io/img/JavaWebComponents/tomcat-architecture.jpg" alt="Tomcat架构图"></p>
<h3 id="tomcat使用">Tomcat使用</h3>
<h5 id="配置虚拟目录">配置虚拟目录</h5>
<p>**方法1：**在tomcat的安装目录下conf目录中修改Server.xml文件，在<code>&lt;/Host&gt;</code>标签之前配置子元素<code>&lt;Context&gt;</code>，内容如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Context</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;/虚拟目录名称&#34;</span> <span style="color:#a6e22e">docBase=</span><span style="color:#e6db74">&#34;web应用的绝对路径&#34;</span> <span style="color:#f92672">/&gt;</span>
<span style="color:#75715e">&lt;!-- path属性：配置虚拟目录名的，也就是在url中访问该项目的名称  
</span><span style="color:#75715e">     docBase属性：是用来配置项目的真实路径的 --&gt;</span>
</code></pre></div><p>例如配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Context</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;/webtest&#34;</span> <span style="color:#a6e22e">docBase=</span><span style="color:#e6db74">&#34;d:\secondWeb&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><p>后，开启tomcat服务器后，访问该项目的url是：http://localhost:8080/webtest
该配置的缺点是每次配置都要重新启动tomcat服务器才能生效（tomcat6之后的版本不推荐使用此方法）</p>
<p>**方法2：**在tomcat安装目录下的conf\Catalina\localhost的文件夹中添加一个扩展名是.xml的文件，文件的名字可以用虚拟名称来命名，并在该文件中添加Context元素</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Contxt</span> <span style="color:#a6e22e">docBase=</span><span style="color:#e6db74">&#34;d:\secondWeb&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><ul>
<li>此种方式不需要再配置path属性，因为文件名代表的就是path的内容，即虚拟目录。</li>
<li>如果配置多级虚拟目录的话，使用#来区分多级目录名，例如：aaa#bbb#ccc.xml，该文件中的内容依然是<!-- raw HTML omitted -->，配置后可通过http://127.0.0.1:8080/aaa/bbb/ccc/a.html进行访问</li>
</ul>
<p>**方法3：**配置默认的web应用：在tomcat安装目录下的conf\Catalina\localhost目录中新建ROOT.xml文件，该文件的内容是：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Context</span> <span style="color:#a6e22e">docBase=</span><span style="color:#e6db74">&#34;d:\secondWeb&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><p>配置后连接http://localhost:8080访问的是该配置的项目而非默认的tomcat启动目录。</p>
<h5 id="修改tomcat的端口号">修改tomcat的端口号</h5>
<p>在tomcat安装目录下的conf目录中的server.xml文件中找到<code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt;</code>并修改port属性值，如果改成默认的80端口，访问web应用是就不需要输入端口号。如果启动时提示端口号已被占用，需要再次修改要改端口号。</p>
<h5 id="配置虚拟主机">配置虚拟主机：</h5>
<p>在tomcat安装目录下的conf目录中修改server.xml文件，在<code>&lt;/Host&gt;</code>后面标签后添加</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Host</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;主机名&#34;</span> <span style="color:#a6e22e">appBase=</span><span style="color:#e6db74">&#34;项目的绝对路径&#34;</span><span style="color:#f92672">&gt;</span>  
    <span style="color:#f92672">&lt;Context</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;&#34;</span>   <span style="color:#a6e22e">docBase=</span><span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/Host&gt;</span>
</code></pre></div><p>注意：主机名一定要在本机C:\WINDOWS\system32\drivers\etc\hosts目录中进行映射过，也就是该主机名有一个对应IP地址，当服务器启动后，在URL输入一个在本机映射过的主机名，这时候会到server.xml文件中去查找有没有对应的主机名的<!-- raw HTML omitted -->元素，如果有就运行该元素中的<!-- raw HTML omitted -->元素指定的路径所对应的项目。</p>
<h3 id="javaweb路径问题">JavaWeb路径问题</h3>
<p>路径分为两种：客户端路径和服务器端路径</p>
<ol>
<li>
<p>客户端（浏览器）路径</p>
<ul>
<li>带&rdquo;/&ldquo;指相对于主机，例如表单所在页面路径为http://localhost:8080/webproject/login.jsp，此时&rdquo;/&rdquo; 代表http://localhost:8080/</li>
<li>不带&rdquo;/&ldquo;表示从当前目录找，例如表单所在页面路径为http://localhost:8080/webprojec/info/login.jsp ，不带“/”则代表http://localhost:8080/webprojec/info/，不过开发中不要出现不带&rdquo;/&ldquo;的情况</li>
</ul>
</li>
<li>
<p>服务器端路径
&ldquo;/&quot;: 相对于项目，&quot;/&ldquo;即表示http://localhost:8080/webproject/</p>
</li>
</ol>
<h3 id="使用相对路径解决路径写死问题">使用相对路径解决路径写死问题</h3>
<p><code>File file=new File(&quot;xxx.xml&quot;)</code>，file无法使用相对路径，因为此写法的相对路径是相对于jvm服务器开始运行的地方，即从Tomcat的bin目录下去找。</p>
<p>上述方法不行可以使用servletContext提供的方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#75715e">// 在servletContext中获得资源的方法
</span><span style="color:#75715e"></span>    ServletContext sc <span style="color:#f92672">=</span> getServletContext<span style="color:#f92672">();</span>

    <span style="color:#75715e">// 1.根据相对路径获得指定资源流,相对的是webRoot下
</span><span style="color:#75715e"></span>    InputStream is <span style="color:#f92672">=</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/students.xml&#34;</span><span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>is<span style="color:#f92672">);</span>

    <span style="color:#75715e">// 2.通过相对路径获得绝对路径
</span><span style="color:#75715e"></span>    String path <span style="color:#f92672">=</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/students.xml&#34;</span><span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>path<span style="color:#f92672">);</span>

    <span style="color:#75715e">// path填写相对路径“/”，所有servletContext中关于路径的获得，相对路径都是相对的 WebRoot(项目根)下
</span></code></pre></div><p>但如果资源文件是放在某个包下面，使用servletContext提供的方法可以获得，但填写路径太过麻烦：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//获得cn.iamwyj.servlet.servlet_context包下的资源
</span><span style="color:#75715e"></span>getServletContext<span style="color:#f92672">().</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/classes/cn/itcast/servlet/d_servletContext/students.xml&#34;</span><span style="color:#f92672">);</span>
</code></pre></div><p>针对以上问题有两种解决方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 方法一：
</span><span style="color:#75715e"></span>InputStream is <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;students.xml&#34;</span><span style="color:#f92672">);</span>
<span style="color:#75715e">// 方法二：
</span><span style="color:#75715e"></span>InputStream is <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;students.xml&#34;</span><span style="color:#f92672">);</span>
</code></pre></div><ol>
<li>
<p>方法一使用<code>this.getClass().getResourceAsStream(&quot;xxx&quot;)</code>获得流，使用<code>this.getClass().getResource(&quot;xxx&quot;).getPath()</code>获得绝对路径，
相对路径分为两种情况：</p>
<ol>
<li>加&rdquo;/&ldquo;相对的是classes目录；</li>
<li>
<ol start="2">
<li>不加&rdquo;/&ldquo;相对的是当前类文件所在目录</li>
</ol>
</li>
</ol>
</li>
<li>
<p>方法二使用<code>this.getClass().getClassLoader().getResourceAsStream(&quot;xxx&quot;)</code>获得流，使用<code>this.getClass().getClassLoader().getResource(&quot;xxx&quot;).getPath()</code>获得绝对路径，
只有一个相对路径,相对于classes目录</p>
</li>
</ol>
<p>Class和ClassLoader原则上是用来加载字节码文件的，一旦第一次加载完毕就会放在内存中，直到虚拟机关闭</p>
<ol>
<li>因为jvm运行期间只加载一次，所以当文件发生变化，使用class和classloader读只能获得第一次加载的，但是使用下面的代码获得绝对路径可以解决这个问题.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//获得绝对路径
</span><span style="color:#75715e"></span>String path <span style="color:#f92672">=</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;students.xml&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">();</span>
File file <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>path<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> path<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()));</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>path<span style="color:#f92672">);</span>
</code></pre></div><ol start="2">
<li>getClassLoader()原本是用来加载.class文件的, 因此缓存设计的很小，不要用来加载较大的资源。</li>
</ol>
<p>Demo</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 关于Servlet路径配置问题详解
</span><span style="color:#75715e"></span><span style="color:#f92672">import</span> java.io.File<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.InputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.Set<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.servlet.ServletContext<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.ServletException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServlet<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletRequest<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> javax.servlet.http.HttpServletResponse<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServletPath</span> <span style="color:#66d9ef">extends</span> HttpServlet <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doGet</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>

        <span style="color:#75715e">// 在servletContext中获得资源的方法
</span><span style="color:#75715e"></span>        ServletContext sc <span style="color:#f92672">=</span> getServletContext<span style="color:#f92672">();</span>

        <span style="color:#75715e">// 1.根据相对路径获得指定资源流,相对的是webRoot下
</span><span style="color:#75715e"></span>        InputStream is <span style="color:#f92672">=</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/students.xml&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>is<span style="color:#f92672">);</span>

        <span style="color:#75715e">// 2.通过相对路径获得绝对路径
</span><span style="color:#75715e"></span>        String path <span style="color:#f92672">=</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/students.xml&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>path<span style="color:#f92672">);</span>

        <span style="color:#75715e">// &#34;/&#34;是相对于根目录的
</span><span style="color:#75715e"></span>        Set set <span style="color:#f92672">=</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourcePaths</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Object obj <span style="color:#f92672">:</span> set<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        String path2 <span style="color:#f92672">=</span> sc<span style="color:#f92672">.</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/students.xml&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>path2<span style="color:#f92672">);</span>

        <span style="color:#75715e">// 获得lib目录下的资源
</span><span style="color:#75715e"></span>        getServletContext<span style="color:#f92672">().</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/lib/students.xml&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">// 获得src下的资源==&gt; 获得classes目录下的资源
</span><span style="color:#75715e"></span>        getServletContext<span style="color:#f92672">().</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/classes/students.xml&#34;</span><span style="color:#f92672">);</span>
 
        <span style="color:#75715e">// 获得cn.iamwyj.servlet.servlet_context包下的资源
</span><span style="color:#75715e"></span>        getServletContext<span style="color:#f92672">().</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/classes/cn/itcast/servlet/d_servletContext/students.xml&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//如果获得的是包下的资源文件,则路径太麻烦
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/* 解决方法：
</span><span style="color:#75715e">        1.使用getClass().getResourceAsStream获得流，使用getClass().getResource.getPath()获得路径
</span><span style="color:#75715e">        相对路径分为两种情况:
</span><span style="color:#75715e">        1.加&#34;/&#34;相对的是classes目录
</span><span style="color:#75715e">        2.不加&#34;/&#34;相对的是本类当前目录*/</span>
        InputStream is2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;students.xml&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>is<span style="color:#f92672">);</span>

        <span style="color:#75715e">/*2.使用this.getClass().getClassLoader().getResourceAsStream获得流，使用this.getClass().getClassLoader().getResource.getPath获得路径
</span><span style="color:#75715e">        只有一个相对路径,就是相对于 classes目录*/</span>
        InputStream is3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;students.xml&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>is2<span style="color:#f92672">);</span>

        <span style="color:#75715e">//注意: 使用类和类加载器加载资源文件时
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//1.jvm运行期间只加载一次. 但是使用下面的代码可以解决这个问题.
</span><span style="color:#75715e"></span>        String path3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;students.xml&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">();</span>
        File file <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>path<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> path<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()));</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>path<span style="color:#f92672">);</span>
        <span style="color:#75715e">//2.getClassLoader()原本是用来加载.class文件的, 所以缓存设计的很小.不要用他加载一些别较大的资源.
</span><span style="color:#75715e"></span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doPost</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span>
            <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>

    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div>
</article>


<p class="post-meta">
    Tags:&nbsp;
    
    
    <a href="https://w-yj.github.io/tags/JavaWeb">JavaWeb</a>
    
</p>



            </div>
        </div>
    </div>
    <footer class="center">
    <div class="p2 wrap">
        <div class="measure mt1 center">
            <small>
                Copyright &#169; 2017<br>
                Powered by <a href="http://gohugo.io/" target="_blank">Hugo</a> &amp; <a
                    href="https://github.com/azmelanar/hugo-theme-pixyll" target="_blank">Pixyll</a>
            </small>
        </div>
    </div>
</footer>

</body>
</html>